<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.3/ScrollTrigger.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>

<div class="max-w-screen-lg px-8 py-12 mx-auto md:px-4 md:py-24" id="tokenomics">

    <div class="mb-8 text-headline text-center">CAM Tokenomics</div>
    <div class="flex flex-col items-center gap-4 md:gap-8 2xl:gap-16 lg:flex-row">
        <div class="flex flex-col w-full h-full lg:w-2/3" id="chart-container">
            <div id="chart" class="w-full h-full"></div>
        </div>
        <div class="flex flex-col-reverse w-full h-full gap-2 md:w-4/6 lg:w-1/3">
            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#149EED]/10 hover:scale-105" id="Founders">
                <div class="h-auto w-1.5 mr-4 bg-[#149EED]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#149EED]">7%</span>&nbsp;&nbsp;Founders</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">70 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#358CF1]/10 hover:scale-105" id="Team">
                <div class="h-auto w-1.5 mr-4 bg-[#358CF1]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#358CF1]">7.5%</span>&nbsp;&nbsp;Team</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">75 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#5678F4]/10 hover:scale-105" id="Advisors">
                <div class="h-auto w-1.5 mr-4 bg-[#5678F4]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#5678F4]">2.5%</span>&nbsp;&nbsp;Advisors</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">25 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#7467F7]/10 hover:scale-105" id="Seed-Invesment">
                <div class="h-auto w-1.5 mr-4 bg-[#7467F7]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#7467F7]">4.3%</span>&nbsp;&nbsp;Seed Investment</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">43 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#9355FA]/10 hover:scale-105" id="Pre-Sale">
                <div class="h-auto w-1.5 mr-4 bg-[#9355FA]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#9355FA]">5%</span>&nbsp;&nbsp;Pre-Sale</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">50 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#B143FC]/10 hover:scale-105" id="IEO">
                <div class="h-auto w-1.5 mr-4 bg-[#B143FC]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#B143FC]">7.5%</span>&nbsp;&nbsp;IEO</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">75 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#A05DF0]/10 hover:scale-105" id="dApp-Incentive-Pool">
                <div class="h-auto w-1.5 mr-4 bg-[#A05DF0]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#A05DF0]">20%</span>&nbsp;&nbsp;dApp Incentive Pool</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">200 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#867EE0]/10 hover:scale-105" id="Marketing">
                <div class="h-auto w-1.5 mr-4 bg-[#867EE0]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#867EE0]">5%</span>&nbsp;&nbsp;Marketing</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">50 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#6D9FD0]/10 hover:scale-105" id="Second-Sale">
                <div class="h-auto w-1.5 mr-4 bg-[#6D9FD0]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#6D9FD0]">7.5%</span>&nbsp;&nbsp;Public Sale</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">75 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#55C0C1]/10 hover:scale-105" id="Reward-Pool">
                <div class="h-auto w-1.5 mr-4 bg-[#55C0C1]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#55C0C1]">10%</span>&nbsp;&nbsp;Reward Pool</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">100 000 000 CAM</small>
                    </div>
                </div>
            </div>

            <div class="flex w-full overflow-hidden transition ease-in-out delay-150 rounded-md h-min bg-[#38E6AF]/10 hover:scale-105" id="Reserve">
                <div class="h-auto w-1.5 mr-4 bg-[#38E6AF]"></div>
                <div class="flex flex-col flex-1 gap-0 py-1 pr-3">
                    <div class="flex justify-between font-medium">
                        <small class="text-sm"> <span class="text-[#38E6AF]">23.7%</span>&nbsp;&nbsp;Reserve</small>
                    </div>
                    <div class="flex justify-between font-light">
                        <small class="ml-auto text-xs text-white/30">237 000 000 CAM</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function drawDonutChart() {
            var text = 'Total Supply'
            var subText = '1 000 000 000'
            var screenWidth = window.innerWidth

            var margin = { left: 55, top: 55, right: 55, bottom: 55 }
            var width = Math.min(screenWidth, 500) - margin.left - margin.right
            var height = Math.min(screenWidth, 500) - margin.top - margin.bottom
            var newArc

            var thickness = 8
            var radius = Math.min(width, height) / 2

            var svg = d3
                .select('#chart')
                .append('svg')
                .attr('width', '100%')
                .attr('height', '100%')
                .attr('viewBox', -((width + margin.left + margin.right) / 2) + ' ' + -(height + margin.left + margin.right) / 2 + ' ' + (width + margin.left + margin.right) + ' ' + (height + margin.left + margin.right))
                .append('g')
                .attr('class', 'wrapper')

            var data = [
                { label: '7%', name: 'Founders', value: 7, color: '#149EED' },
                { label: '7.5%', name: 'Team', value: 7.5, color: '#358CF1' },
                { label: '2.5%', name: 'Advisors', value: 2.5, color: '#5678F4' },
                { label: '4.3%', name: 'Seed-Investment', value: 4.3, color: '#7467F7' },
                { label: '5%', name: 'Pre-Sale', value: 5, color: '#9355FA' },
                { label: '7.5%', name: 'IEO', value: 7.5, color: '#B143FC' },
                { label: '20%', name: 'dApp-Incentive-Pool', value: 20, color: '#A05DF0' },
                { label: '5%', name: 'Marketing', value: 5, color: '#867EE0' },
                { label: '7.5%', name: 'Second-Sale', value: 7.5, color: '#6D9FD0' },
                { label: '10%', name: 'Reward-Pool', value: 10, color: '#55C0C1' },
                { label: '23.7%', name: 'Reserve', value: 23.7, color: '#38E6AF' },
            ]

            var arc = d3.svg
                .arc()
                .innerRadius(radius - thickness)
                .outerRadius(radius)

            var pie = d3.layout
                .pie()
                .startAngle((-90 * Math.PI) / 180)
                .endAngle((-90 * Math.PI) / 180 + 2 * Math.PI)
                .value(function (d) {
                    return d.value
                })
                .padAngle(0.01)
                .sort(null)

            svg.selectAll('.donutArcs')
                .data(pie(data))
                .enter()
                .append('path')
                .attr('class', 'donutArcs')
                .attr('d', arc)
                .attr('fill', (d, i) => d.data.color)
                .attr('opacity', 1)
                .each(function (d, i) {
                    var firstArcSection = /(^.+?)L/

                    newArc = firstArcSection.exec(d3.select(this).attr('d'))[1]
                    newArc = newArc.replace(/,/g, ' ')

                    if (d.endAngle > (90 * Math.PI) / 180) {
                        var startLoc = /M(.*?)A/,
                            middleLoc = /A(.*?)0 0 1/,
                            endLoc = /0 0 1 (.*?)$/
                        var newStart = endLoc.exec(newArc)[1]
                        var newEnd = startLoc.exec(newArc)[1]
                        var middleSec = middleLoc.exec(newArc)[1]

                        newArc = 'M' + newStart + 'A' + middleSec + '0 0 0 ' + newEnd
                    }

                    svg.append('path')
                        .attr('class', 'hiddenDonutArcs')
                        .attr('id', 'donutArc' + i)
                        .attr('d', newArc)
                        .style('fill', 'none')
                })
                .on('mouseover', function (d, i) {
                    d3.select('#' + d.data.name).classed('scale-105', true)
                    d3.select('.label-text' + i).attr('opacity', 0.5)
                    d3.select(this).transition().duration(100).attr('opacity', 0.5)
                })
                .on('mouseout', function (d, i) {
                    d3.select('#' + d.data.name).classed('scale-105', false)
                    d3.select('.label-text' + i).attr('opacity', 1)
                    d3.select(this).transition().duration(100).attr('opacity', 1)
                })

            // Add a group element for each label
            svg.selectAll('.label-group')
                .data(pie(data))
                .enter()
                .append('g')
                .attr('class', 'label-group')
                .attr('transform', function (d) {
                    var centroid = arc.centroid(d)
                    var x = centroid[0] * 1.17
                    var y = centroid[1] * 1.17
                    return 'translate(' + x + ', ' + y + ')'
                })
                .append('text')
                .attr('class', function (d, i) {
                    return 'label-text' + i
                })
                .text(function (d) {
                    return d.data.label
                })
                .attr('text-anchor', 'middle')
                .attr('dy', '0.35em')
                .style('fill', (d, i) => d.data.color)
                .attr('opacity', 1)
                .style('font-size', '10px')

            // the camino logo and the supply
            svg.append('image').attr('xlink:href', '../static/images/branding/2024/Camino-Token-Logo.png').attr('width', 35).attr('height', 35).attr('x', -17.5).attr('y', -35)
            svg.append('text').attr('class', 'supply font-extralight fill-white text-xs md:text-sm z-10').text(subText).attr('text-anchor', 'middle').attr('dy', '2em')

            // the circle in the middle of the donut
            svg.append('circle')
                .attr('cx', 0)
                .attr('cy', 0)
                .attr('class', 'circle-inside')
                .attr('class', 'fill-white/5')
                .attr('r', radius / 1.8)

            // the dotted circle in the middle of the donut
            svg.append('circle')
                .attr('cx', 0)
                .attr('cy', 0)
                .attr('class', 'circle-dotted')
                .attr('fill', 'none')
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .attr('stroke-dasharray', '2, 2')
                .attr('r', radius / 1.5)
                .attr('opacity', 0.3)
        }

        drawDonutChart()
    </script>
</div>
